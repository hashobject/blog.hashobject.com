<!DOCTYPE html>
<html itemscope="" itemtype="http://schema.org/BlogPosting" lang="en"><head><meta charset="utf-8"><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"><meta content="width=device-width, initial-scale=1.0, user-scalable=no" name="viewport"><meta content="HashObject (team@hashobject.com)" itemprop="author" name="author"><meta content="clojure, amazon beanstalk, https, sls, aws, heroku, deploy, web app, amazon route 53, naked domain" itemprop="keywords" name="keywords"><meta content="Short guide how to deploy Clojure web app on Amazon Beanstalk with HTTPS support with almost no cost." itemprop="description" name="description"><meta itemprop="inLaguage"><meta content="2013-06-03" itemprop="dateCreated"><meta content="2013-06-06" itemprop="dateModified"><meta content="2013-06-06" itemprop="datePublished"><title itemprop="name">Configure Clojure web app to run with HTTPS support on Amazon Beanstalk</title><link href="/css/app.css" rel="stylesheet" type="text/css"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-41533076-2', 'hashobject.com');
  ga('send', 'pageview');</script></head><body><header></header><div class="row"><div class="content"><article class="post-content columns large-12"><header class="post-metadata"><h1 itemprop="name">Configure Clojure web app to run with HTTPS support on Amazon Beanstalk</h1><a class="author" href="http">Anton Podviaznikov</a><span class="date-published">Jun 06, 2013</span></header><p><!-- name: Configure Clojure web app to run with HTTPS support on Amazon Beanstalk description: Short guide how to deploy Clojure web app on Amazon Beanstalk with HTTPS support with almost no cost. author: Anton Podviaznikov author_url: http://hashobject.com/team/anton author_github: podviaznikov author_twitter: podviaznikov location: Guatemala City, Guatemala date_created: 2013-06-03 date_modified: 2013-06-06 date_published: 2013-06-06 headline: inLanguage: en keywords: clojure, amazon beanstalk, https, sls, aws, heroku, deploy, web app, amazon route 53, naked domain --><h2>Intro</h2></p><p>Currently there are several options of hosting Clojure web apps.</p><p>The obvious one is <a href='http://heroku.com'>Heroku</a> with their great <a href='https://devcenter.heroku.com/articles/clojure-web-application'>guide</a>.</p><p>However if you web app need SSL support on custom domain you immediately need to pay $20/month for the <a href='https://addons.heroku.com/ssl'>Heroku addon</a>.</p><p>The second option is to host your Clojure web app on Amazon EC2. This can be done almost for free for the first year if your app is small enough. Check out AWS <a href='http://aws.amazon.com/free/'>Free Usage Tier</a>. Hosting web app on Amazon EC2 has its own upsides and downsides.</p><p>There is third solution (probably there are much more options out there) that I want to describe in this post.</p><p><h2>Amazon Beanstalk</h2></p><p>Amazon has product in their AWS suite which reminds Heroku a lot.</p><p>It's called <a href='http://aws.amazon.com/elasticbeanstalk/'>Beanstalk</a>. According to Amazon docs:</p><blockquote><p>New AWS customers who are eligible for the AWS free usage tier can deploy an application in Elastic Beanstalk for free. </p></blockquote><p>There are some resource that can help Clojure developers to deploy their apps on Beanstalk. I recommend reading this <a href='http://www.ctdean.com/2012/04/10/aws-beanstalk-on-clojure.html'>blog post</a> and using <a href='https://github.com/weavejester/lein-beanstalk'>lein-beanstalk</a> plugin.</p><p>Basically you will be able to deploy you app using following command:</p><pre>
lein beanstalk deploy prod
</pre><p>Where <code>prod</code> name of you environment that you need to specify when you'll create Beanstalk app.</p><p>Creating Amazon Beanstalk application is easy. Just follow official <a href='http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create&#95;deploy&#95;Java.html'>docs</a>. You can choose Tomcat 6 or Tomcat 7 as container (both 32 and 64 bit).</p><p><h2>How to get SSL certificate</h2></p><p>I'm usually getting my SSL certificates from <a href='http://www.startssl.com/'>StartSSL</a>.</p><p>They are providing Class 1 SSL certificates for 1 year for free.</p><p>What you will get from them (after registration and applying for certificate) is two files:</p><ul><li>certificate (let's call it server.crt).    File content starts with <code>'-----BEGIN CERTIFICATE-----'</code>.</li><li>private key (let's call it ssl.key).    File content starts with <code>'-----BEGIN RSA PRIVATE KEY-----'</code>.</li></ul><p>You shouldn't share these files.</p><p><h2>How to setup custom domain(naked domain) for Beanstalk application</h2></p><p>I recommend to use <a href='http://aws.amazon.com/route53/'>Amazon Route 53</a> for managing DNS records. If you have hosted zone on Amazon Route 53 for your domain name then you need just to create new Record set of type A.</p><p>Select "Yes" for "Alias" field and you will be able to select Elastic Load balancer that works with your Beantalk intace in the "Alias target" field.</p><p>After this is done you will be able to reach your web app using naked domain name (e.x. example.com instead of www.example.com).</p><p><h2>How to configure HTTPS support for you Beanstalk application</h2></p><p>There is nice article in Amazon <a href='http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/configuring-https.html'>docs</a> how to add HTTPS support for your Beanstalk application.</p><p>Basically there are 2 main steps:</p><ul><li>upload your SSL certificate using command: <code>iam-servercertupload -b server.crt -k ssl.key -s server</code>.</li><li>you will get Amazon Resource name for your certificate similar to <code>arn:aws:iam::123456789012:server-certificate/cert</code>.</li><li>edit configuration for you Beanstalk app. In the "Load balancer" section specify:</li></ul><pre>
      Secure listener port: 443
      Protocol: HTTPS
      SSL Certiificate ID: Amazon Resource name that you received after certificate upload.
</pre><p><h2>Conclusion</h2></p><p>There are some configuration steps that needed to have web app working on naked domain with HTTPS support.</p><p>In this post I tried to describe steps needed to have secure naked domain for Clojure web app deployed to Amazon Beanstalk.</p></article></div></div><footer></footer></body></html>