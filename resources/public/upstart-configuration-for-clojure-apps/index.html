<!DOCTYPE html>
<html itemscope="" itemtype="http://schema.org/BlogPosting"><head><meta charset="utf-8"><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"><meta content="width=device-width, initial-scale=1.0, user-scalable=no" name="viewport"><meta content="Anton Podviaznikov (anton@hashobject.com)" itemprop="author" name="author"><meta content="clojure, upstart, ubuntu, leiningen" itemprop="keywords" name="keywords"><meta content="Short guide how to create Ubuntu Upstart configuration for Clojure apps using Leiningen" itemprop="description" name="description"><meta content="en" itemprop="inLanguage"><meta content="2013-09-01" itemprop="dateCreated"><meta content="2013-09-01" itemprop="dateModified"><meta content="2013-09-01" itemprop="datePublished"><title itemprop="name">Upstart configuration for Clojure apps</title><link href="/favicon.ico" rel="shortcut icon"><link href="https://plus.google.com/118068495795214676039" rel="publisher"><link href="humans.txt" rel="author"><link href="feed.rss" rel="alternate" title="RSS" type="application/rss+xml"><link href="https://github.com/hashobject/blog.hashobject.com/issues/8" rel="discussionUrl"><link href="http://blog.hashobject.com/upstart-configuration-for-clojure-apps" rel="canonical"><link href="/css/app.css" rel="stylesheet" type="text/css"><link href="http://fonts.googleapis.com/css?family=PT+Sans" rel="stylesheet" type="text/css"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-41533076-2', 'hashobject.com');
  ga('send', 'pageview');</script></head><body><div class="off-canvas-wrap"><div class="inner-wrap"><div class="contain-to-grid"><nav class="top-bar hide-for-small" data-topbar="" role="navigation"><ul class="title-area"><li class="name"><h1><a href="http://blog.hashobject.com"><div class="logo"></div></a></h1></li></ul><section class="top-bar-section"><ul class="right"><li><a href="http://hashobject.com">Home</a></li><li class="active"><a href="http://blog.hashobject.com">Blog</a></li><li><a href="http://os.hashobject.com">Open Source</a></li></ul></section></nav><nav class="tab-bar show-for-small"><a class="left-off-canvas-toggle menu-icon"><span>Hashblog</span></a></nav><a class="exit-off-canvas"></a><aside class="left-off-canvas-menu"><ul><li><label>Hashobject</label></li><li><a href="http://hashobject.com">Home</a></li><li class="active"><a href="http://blog.hashobject.com">Blog</a></li><li><a href="http://os.hashobject.com">Open Source</a></li></ul></aside></div><div class="row"><div class="post small-12 columns"><h1 itemprop="name">Upstart configuration for Clojure apps</h1><p><!-- name: Upstart configuration for Clojure apps description: Short guide how to create Ubuntu Upstart configuration for Clojure apps using Leiningen author: Anton Podviaznikov author_email: anton@hashobject.com author_url: http://twitter.com/podviaznikov author_github: podviaznikov author_twitter: podviaznikov author_avatar: /images/anton-avatar.png location: Quito, Ecuador date_created: 2013-09-01 date_modified: 2013-09-01 date_published: 2013-09-01 headline: in_language: en keywords: clojure, upstart, ubuntu, leiningen discussion_url: https://github.com/hashobject/blog.hashobject.com/issues/8 canonical_url: http://blog.hashobject.com/upstart-configuration-for-clojure-apps --><h2>Intro</h2></p><p>If you are deploying any app to production you want to run it as Linux daemon. In Ubuntu you can use <a href='http://upstart.ubuntu.com/'>Upstart</a> as tool that will restart you app automatically in case of crash.</p><h2>Instructions</h2><p>To use Upstart you need to create configuration file for your app inside the /etc/init directory.</p><p>Pick up any good name for your app (e.x. 'mywebapp') and create file /etc/init/mywebapp.conf</p><p><code>nano /etc/init/mywebapp.conf</code></p><p>Let's assume that you have source code for your app in the following directory: <code>/root/apps/mywebapp</code> and you can run you application within directory using lein <code>lein with-profile prod ring server</code>.</p><p>Then /etc/init/mywebapp.conf content should look similar to this:</p><pre class="brush: shell">

  author &quot;Team Hashobject&quot;
  description &quot;Start the mywebapp clojure on port 3000&quot;
  start on &#40;local-filesystems and net-device-up IFACE!=lo&#41;
  chdir root/apps/communi.st
  env LEIN&#95;ROOT=yes
  exec lein with-profile prod ring server

</pre><p>The last 3 lines are the most important:</p><ul><li>chdir allows you to configure path to the source code</li><li>setting environment variable LEIN_ROOT disables warning that you may see if you try to run app under the root</li><li>exec - actually starts your ring server</li></ul><p>This is just sample upstart configuration file. You can refer documenatation for more features.</p><p>After you save this configuration you can start your app using <code>start mywebapp</code> and stop it using <code>stop mywebapp</code></p><p>All logs for you app will be available in /var/log/upstart/mywebapp.log file.</p><h2>Conclusion</h2><p>Provided instructions should definitely work on Ubuntu 13.04. This configuration was tested on <a href='http://digitalocean.com'>DigitalOcean</a> with Leiningen 2 and Clojure 1.5.1.</p><p>In this post I described how to run Clojure web app in production using Leiningen and Upstart.</p><p>You can also do this by just running Java jar files using Upstart. See following <a href='https://theholyjava.wordpress.com/2013/07/27/running-a-leiningenring-webapp-as-a-daemon-via-upstart-ubuntu'>article</a> for more details.</p><aside class="post-meta small-12 columns"><img class="author-avatar" src="/images/anton-avatar.png" title="Anton Podviaznikov"><div class="meta-info"><div><span class="meta-label">Written by</span><a class="author-name" href="http://twitter.com/podviaznikov">Anton Podviaznikov</a></div><div><span class="meta-label">Published: </span><span>Sep 01, 2013</span></div><div><span class="meta-label">Modified: </span><span>Sep 01, 2013</span></div><div><span class="meta-label">Published in: </span><span>Quito, Ecuador</span></div><div><span class="meta-label">Reading time: </span><span>2 mins</span></div></div></aside></div><footer class="post-discussion small-12 columns">Discussion for this post available on <a href="https://github.com/hashobject/blog.hashobject.com/issues/8">GitHub</a>.</footer></div><footer class="row"><p class="license small-12 columns">Except as otherwise noted, the content of this site is licensed
     under the <a href='http://creativecommons.org/licenses/by/3.0/'>Creative Commons Attribution 3.0 License</a>,
     and code samples are licensed under the
     <a href='http://opensource.org/licenses/eclipse-1.0'>Eclipse Public License 1.0</a>.</p><script src="/js/vendor.js" type="text/javascript"></script><script>$(document).foundation();</script></footer></div></div></body></html>